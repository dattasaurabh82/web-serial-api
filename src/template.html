<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0, minimum-scale=1.0" />
    <style>
      body {
        font-family: SFMono-Regular, Consolas, "Liberation Mono", Menlo, monospace;
        max-width: 40em;
      }

      .bubble {
        background: blue;
        border-radius: 1em;
        padding: 1em;
        color: white;
      }

      .notice {
        background: orange;
      }

      .demo {
        background: #2c2b2f;
        border-radius: 3em;
        padding: 0 1em;
        overflow: auto;
        position: relative;
      }

      img {
        float: left;
      }

      button {
        font-family: SFMono-Regular, Consolas, "Liberation Mono", Menlo, monospace;
        font-size: 1em;
        border-radius: 1em;
        border-width: 2px;
        padding: 0.5em 1em;
        border-color: #2c2b2f;
      }

      figcaption {
        text-align: right;
        margin: 1em 1.5em 0 0;
      }
    </style>
    <!-- split -->
    <button id="connect-button" type="button" disabled>ðŸ”Œ Connect</button>

    <script>
      const connectButton = document.getElementById ('connect-button');
      let port;

      if ('serial' in navigator) {
        connectButton.addEventListener('click', function () {
          if (port) {
            port.close();
            port = undefined;

            connectButton.innerText = 'ðŸ”Œ Connect';
          }
          else {
            getReader();
          }
        });

        connectButton.disabled = false;
      }
      else {
        const firstBubble = document.querySelector('p.bubble');
        const noSerialSupportNotice = document.createElement('p');
        noSerialSupportNotice.innerHTML = '<p class="notice bubble">You\'re on the right track! This browser is lacking support for Web Serial API, though, and thats a bummer.</p>';

        firstBubble.parentNode.insertBefore(noSerialSupportNotice, firstBubble.nextSibling);
      }
    </script>
  </body>
</html>
