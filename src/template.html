<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0, minimum-scale=1.0" />
    <style>
      body {
        font-family: SFMono-Regular, Consolas, "Liberation Mono", Menlo, monospace;
        max-width: 40em;
      }

      .bubble {
        background: blue;
        border-radius: 1em;
        padding: 1em;
        color: white;
      }

      .notice {
        background: orange;
      }

      .demo {
        background: #2c2b2f;
        border-radius: 3em;
        padding: 0 1em;
        overflow: auto;
        position: relative;
      }

      img {
        float: left;
      }

      button {
        font-family: SFMono-Regular, Consolas, "Liberation Mono", Menlo, monospace;
        font-size: 1em;
        border-radius: 1em;
        border-width: 2px;
        padding: 0.5em 1em;
        border-color: #2c2b2f;
        outline: none;
      }

      figure {
        opacity: 0;
      }

      figcaption {
        text-align: right;
        margin: 1em 1.5em 0 0;
      }
    </style>
    <style>
      /*!
       * animate.css -https://daneden.github.io/animate.css/
       * Version - 3.7.2
       * Licensed under the MIT license - http://opensource.org/licenses/MIT
       *
       * Copyright (c) 2019 Daniel Eden
       */
      @keyframes bounceIn {
        from,
        20%,
        40%,
        60%,
        80%,
        to {
          animation-timing-function: cubic-bezier(0.215, 0.61, 0.355, 1);
        }

        0% {
          opacity: 0;
          transform: scale3d(0.3, 0.3, 0.3);
        }

        20% {
          transform: scale3d(1.1, 1.1, 1.1);
        }

        40% {
          transform: scale3d(0.9, 0.9, 0.9);
        }

        60% {
          opacity: 1;
          transform: scale3d(1.03, 1.03, 1.03);
        }

        80% {
          transform: scale3d(0.97, 0.97, 0.97);
        }

        to {
          opacity: 1;
          transform: scale3d(1, 1, 1);
        }
      }

      .bounceIn {
        animation-duration: 0.75s;
        animation-name: bounceIn;
      }

      @keyframes fadeOut {
        from {
          opacity: 1;
        }

        to {
          opacity: 0;
        }
      }

      .fadeOut {
        animation-name: fadeOut;
      }

      .animated {
        animation-duration: 1s;
        animation-fill-mode: both;
      }

      .animated.fast {
        animation-duration: 800ms;
      }
    </style>
    <!-- split -->

    <script>
      const connectButton = document.getElementById ('connect-button');
      let port;

      if ('serial' in navigator) {
        connectButton.addEventListener('click', function () {
          if (port) {
            port.close();
            port = undefined;

            connectButton.innerText = 'ðŸ”Œ Connect';
            document.querySelector('figure').classList.replace('bounceIn', 'fadeOut');
          }
          else {
            getReader();
          }
        });

        connectButton.disabled = false;
      }
      else {
        const firstBubble = document.querySelector('p.bubble');
        const noSerialSupportNotice = document.createElement('p');
        noSerialSupportNotice.innerHTML = '<p class="notice bubble">You\'re on the right track! This browser is lacking support for Web Serial API, though, and thats a bummer.</p>';

        firstBubble.parentNode.insertBefore(noSerialSupportNotice, firstBubble.nextSibling);
      }
    </script>
  </body>
</html>
